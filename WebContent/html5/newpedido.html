<!DOCTYPE html>
<html lang="pt-br">
<head>
<title>VirtualQueue</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script src="../js/jquery/jquery-2.1.4.min.js" type="text/javascript"></script>
<script src="../js/jquery/jquery.serializejson.js"
	type="text/javascript"></script>

</head>
<body>
	<div class="container">
		<h3>Pedido</h3>
		<div class="form-group"></div>
		<div class="form-group" id="div1">
			<select class="form-control" name="nomeCombox1" id="nomeCombox1">
				<option value="Big Mac 1">Big Mac 1</option>
			</select>
		</div>
		<div class="form-group">
			<div class="col-sm-offset">
				<input type="submit" class="btn btn-default" value="Adicionar"
					onclick="addProduto()" style="margin-top: 10px;">
			</div>
		</div>

		<div class="">
			<table id="myTable" border="1" class="table stripped">
				<tr>
					<th>Código</th>
					<th>Nome</th>
					<th>Preço</th>
				</tr>
			</table>
		</div>
		<label class="total">TOTAL: R$ 20,00</label> <label class="">Senha:
			258</label>

		<div class="form-group">
			<div class="col-sm-offset">
				<input type="submit" class="btn btn-default"
					value="Finalizar Pedido" onclick="fechar_pedido()"
					style="margin-top: 10px;">
			</div>
		</div>
	</div>


	<script>
		var pedido = [];
		var produtos = [];
		lista();
		populaCombo();
		function lista() {
			var gbWS = "http://localhost:8080/VirtualQueue/VQ/produto/list";
			// faz chamda ao WS REST via ajax	
			$.ajax({
				type : 'GET',
				url : gbWS,
				crossDomain : true,
				dataType : "json",
				success : carregaProduto, // função de retorno do WS
				error : function(xhr, status, error) {
					var err = eval("(" + xhr.responseText + ")");
					alert(err.Message);
				}
			});
		}

		function populaCombo() {
			$("#nomeCombox1")
					.show(
							function() {
								var idCombox1 = $(this).val();
								$
										.ajax({
											dataType : 'json',
											url : "http://localhost:8080/VirtualQueue/VQ/produto/list",
											data : {
												idCombox1 : idCombox1
											},
											success : function(data) {
												var q = '<select name="idCombox2" id="idCombox2" class="form-group"> <option value="0"><-- Selecione o Produto --></option>';
												for (i = 0; i < data.length; i++) {
													q += '<option value=' + data[i].idCombox2 + '>'
															+ data[i].nome
															+ '</option>';
												}
												q += '</select>';
												$('#div1').html(q);
											}
										});
							});
		}

		function carregaProduto(data) {
			alert(JSON.stringify(data));
			produtos = data;
			// gerar Combo dos Produtos
		}

		function addProduto() {

			/*private int cod_produto;
			private String nome;
			private String descricao;
			private String tipo;
			private double preco;*/

			var produto = new Object();
			produto.cod_produto = "";
			produto.nome = "";
			produto.descricao = "";
			produto.tipo = "";
			produto.preco = "";
			pedido.push(produto);

			var table = document.getElementById("myTable");
			var row = table.insertRow(1);
			var cell1 = row.insertCell(0);
			var cell2 = row.insertCell(1);
			var cell3 = row.insertCell(2);
			cell1.innerHTML = "1";
			cell2.innerHTML = document.getElementById("nomeCombox1").value.nome;
			cell3.innerHTML = "R$ 10,00";
		}

		function fechar_pedido() {
			/*
			$.ajax({
			     type: "POST",
			     url: "http://192.241.171.69:8080/Book/webresources/com.percivallucena.book.book/",
			     data: JSON.stringify(pedido),
			     contentType: "application/json; charset=utf-8",
			     dataType: "json",
			     processData: true,
			     success: function (vdata, status, jqXHR) {
			         alert("book has been added to wishlist");
			     },
			     error: function (xhr) {
			         alert("error" + xhr.responseText);
			     }
			 });
			 */
			alert(JSON.stringify(pedido));
		}
	</script>
</body>
</html>
