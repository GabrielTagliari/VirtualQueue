<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="../../css/modal.css">
</head>
<body>
   	<div class="container">
		<h2>Lista de Produtos</h2>
		<table id="example" class="display compact" cellspacing="0" width="100%"></table>
		<div class="form-group">
		<a href="#openModalCreate"><span class="icon fa-plus"></span></a>
		<a href="#openModalEdit"><span class="icon fa-pencil-square-o"></span></a>
		<span id="remover" class="icon fa-trash-o"></span>
		</div>
		
    </div>
    <div id="openModalCreate" class="modalDialog">
        <div>
            <a href="#close" title="Close" class="close">X</a>
            <h2>Cadastrar Produto</h2>
            <form id="form" action="../../VQ/produto/createform" method="GET">
                <p class="form-group">
                    <label for="inputName">Nome: </label>
                    <input type="text" id="name" name="nome" autofocus="autofocus" required>
                </p>
                <p class="form-group">
                    <label for="inputDescription">Descrição: </label>
                    <input type="text" id="descricao" name="descricao">
                </p>
                <p class="form-group">
                    <label for="inputCategory">Categoria: </label>
                    <input type="text" id="tipo" name="tipo" required>
                </p>
                <p class="form-group">
                    <label for="inputPrice">Valor: </label>
                    <input for="number" id="preco" name="preco" required>
                </p>  
                <button>Cadastrar</button>
            </form>
    </div>
	</div><div id="openModalEdit" class="modalDialog">
        <div>
            <a href="#close" title="Close" class="close">X</a>
            <h2>Editar Produto</h2>
            <form id="form" action="../../VQ/produto/createform" method="GET">
                <p class="form-group">
                    <label for="inputName">Nome: </label>
                    <input type="text" id="name" name="nome" autofocus="autofocus" required>
                </p>
                <p class="form-group">
                    <label for="inputDescription">Descrição: </label>
                    <input type="text" id="descricao" name="descricao">
                </p>
                <p class="form-group">
                    <label for="inputCategory">Categoria: </label>
                    <input type="text" id="tipo" name="tipo" required>
                </p>
                <p class="form-group">	
                    <label for="inputPrice">Valor: </label>
                    <input for="number" id="preco" name="preco" required>
                </p>  
                <button>Cadastrar</button>
            </form>
    </div>
	</div>
    <script>
	    $(document).ready(function(){
	    	$.getJSON( "http://localhost:8080/VirtualQueue/VQ/produto/list", function( data ) {
	    		var produtolist = data;
	    		var table = $('#example').DataTable( {
	  			    scrollY:        '50vh',
	  		        scrollCollapse: true,
	  		        paging:         false,
	  		        "language": {"emptyTable": "Nenhum Produto Cadastrado"},
	  			    "aaData": produtolist,
	  			    "aoColumns": [
	  			      { "sTitle": "Código",   "mData": "id" },
	  			      { "sTitle": "Nome",  "mData": "nome" },
	  			      { "sTitle": "Descrição", "mData": "descricao" },
	  			      { "sTitle": "Tipo", "mData": "tipo" },
	  			      { "sTitle": "Preco", "mData": "preco", render: $.fn.dataTable.render.number( '.', ',', 2, 'R$ ' )}
	  			    ]
	  			  });
	    	 
	    		 $('#example tbody').on( 'click', 'tr', function () {
		  		        $(this).toggleClass('selected');
		  		 });
	    			  		 
	  		    $('#remover').click( function () {
	  		    	var data = table.rows('.selected').data();
	  				if (data.length == 0) {
	  					swal("","Selecione ao menos um produto...")
	  				} else {
	  					swal({   
	  						title: "",   
	  						text: "Deseja realmente deletar este produto?\n (esta ação não poderá ser desfeita)",   
	  						type: "",   
	  						showCancelButton: true,
	  						confirmButtonColor: "#8ebebc",   
	  						confirmButtonText: "Sim",   
	  						cancelButtonText: "Não",   
	  						closeOnConfirm: true,   
	  						closeOnCancel: true }, 
	  						function(isConfirm){   
	  							if (isConfirm) {
	  									for (var int = 0; int < data.length; int++) {
	  										$.ajax({
	  										     type: "POST",
	  										     url: "http://localhost:8080/VirtualQueue/VQ/produto/deleta",
	  										     data: JSON.stringify(data[int].id),
	  										     contentType: "application/json; charset=utf-8",
	  										     dataType: "json",
	  										     processData: true,
	  										     success: function (vdata, status, jqXHR) {
	  										    	 $("#conteudo").load("produtos.html");
	  										     },
	  										     error: function (xhr) {
	  										         alert("Erro" + xhr.responseText);
	  										     }
	  										});
	  									}
	  					}});
	  				}
	  		    });	    
	  	});
	    });    
    </script>
</body>