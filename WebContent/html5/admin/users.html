<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="container">
<h2>Lista de Usuários</h2>
<table id="example" class="display" cellspacing="0" width="100%"> 
</table>
<div class="form-group">
<span class="icon fa-plus"></span>
<span class="icon fa-pencil-square-o"></span> 
<span id="remover" class="icon fa-trash-o"></span>
</div>
</div>
<script>
$(document).ready(function(){
	$.getJSON( "http://localhost:8080/VirtualQueue/VQ/user/list", function( data ) {
		  var userlist = data;
		  var table = $('#example').DataTable( {
			    scrollY:        '50vh',
		        scrollCollapse: true,
		        paging:         false,
		        "language": {"emptyTable": "Nenhum Usuário Cadastrado"},
			    "aaData": userlist,
			    "aoColumns": [
			      { "sTitle": "Código",   "mData": "id" },
			      { "sTitle": "Nome",  "mData": "nome" },
			      { "sTitle": "Email", "mData": "email" },
			      { "sTitle": "Privilégio",  "mData": "privilegio" }
			    ]
			  } );
		   
		    $('#example tbody').on( 'click', 'tr', function () {
		        $(this).toggleClass('selected');
		    } );
		 
		    $('#checar').click( function () {
		    	var data = table.rows('.selected').data();
		    	for (var int = 0; int < data.length; int++) {
					console.log(data[int]);
				}
		    } );
		    
		    $('#remover').click( function () {
  		    	var data = table.rows('.selected').data();
  				if (data.length == 0) {
  					swal("","Selecione ao menos um usuário...")
  				} else {
  					swal({   
  						title: "",   
  						text: "Deseja realmente deletar este usuário?\n (esta ação não poderá ser desfeita)",   
  						type: "",   
  						showCancelButton: true,
  						confirmButtonColor: "#8ebebc",   
  						confirmButtonText: "Sim",   
  						cancelButtonText: "Não",   
  						closeOnConfirm: true,   
  						closeOnCancel: true }, 
  						function(isConfirm){   
  							if (isConfirm) {
  									for (var int = 0; int < data.length; int++) {
  										$.ajax({
  										     type: "POST",
  										     url: "http://localhost:8080/VirtualQueue/VQ/user/deleta",
  										     data: data[int].email,
  										     contentType: "application/json; charset=utf-8",
  										     dataType: "json",
  										     processData: true,
  										     success: function (vdata, status, jqXHR) {
  										    	 $("#conteudo").load("users2.html");
  										     },
  										     error: function (xhr) {
  										         alert("Erro" + xhr.responseText);
  										     }
  										});
  									}
  					}});
  				}
  		    });	
	});
}); 
</script>
</body>
</html>